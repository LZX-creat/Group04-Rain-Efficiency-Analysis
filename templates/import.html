<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <title>ä¸Šä¼ ä¸­å¿ƒ - é›¨æ°´åˆ©ç”¨ç®¡ç†ç³»ç»Ÿ</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <style>
        :root { --sidebar-width: 240px; --primary-blue: #3182ce; }

        /* ã€å…³é”®ä¿®å¤ã€‘å¼ºåˆ¶é”å®š bodyï¼Œä¸å‡† SweetAlert2 ä¹±åŠ¨å¸ƒå±€ */
        body {
            background: #f4f7f9;
            margin: 0;
            font-family: 'Segoe UI', system-ui, sans-serif;
            display: flex;
            height: 100vh;
            overflow: hidden !important; /* å¼ºåˆ¶é”å®šï¼Œé˜²æ­¢å‡ºç°åŒæ»šåŠ¨æ¡ */
        }

        body.swal2-shown {
            padding-right: 0 !important; /* æ‹¦æˆªè¡¥ç™½ */
            overflow: hidden !important;
        }

        /* ã€å…³é”®ä¿®å¤ã€‘ä¾§è¾¹æ æ”¹ä¸ºå›ºå®šå®šä½ï¼Œå½»åº•è„±ç¦»æ–‡æ¡£æµï¼Œä¸å—å¼¹çª—å½±å“ */
        .sidebar {
            width: var(--sidebar-width);
            background: #212529;
            color: white;
            height: 100vh;
            position: fixed; /* å›ºå®šåœ¨å·¦ä¾§ */
            left: 0;
            top: 0;
            z-index: 1000;
        }

        .sidebar-header { padding: 20px; font-size: 1.1rem; background: #1a202c; font-weight: bold; }
        .nav-link { color: #adb5bd; padding: 15px 20px; text-decoration: none; display: block; border-left: 4px solid transparent; transition: 0.2s; }
        .nav-link.active, .nav-link:hover { background: #2d3748; color: white; border-left-color: var(--primary-blue); }

        /* ã€å…³é”®ä¿®å¤ã€‘ä¸»å®¹å™¨è®¾ç½®å·¦è¾¹è·ï¼Œè…¾å‡ºä¾§è¾¹æ çš„ä½ç½® */
        .main-container {
            flex: 1;
            margin-left: var(--sidebar-width); /* ç­‰äºä¾§è¾¹æ å®½åº¦ */
            overflow-y: auto;
            padding: 40px;
            display: flex;
            justify-content: center;
            align-items: flex-start;
            min-height: 100vh;
        }

        .upload-card {
            background: #fff;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.08);
            width: 100%;
            max-width: 700px;
            padding: 40px;
        }

        .upload-area {
            border: 2px dashed #e2e8f0;
            border-radius: 16px;
            padding: 50px 20px;
            text-align: center;
            background: #f8fafc;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            cursor: pointer;
        }
        .upload-area:hover { border-color: var(--primary-blue); background: #f0f7ff; }
        .upload-area.dragover { border-color: var(--primary-blue); background: #e1effe; transform: scale(1.02); }

        .file-icon { font-size: 3.5rem; color: #cbd5e0; margin-bottom: 15px; display: inline-block; }
        .format-hint { background: #fffaf0; border-left: 4px solid #ed8936; padding: 15px; border-radius: 8px; margin-bottom: 30px; }
    </style>
</head>
<body>

<div class="sidebar">
    <div class="sidebar-header">ğŸŒ§ï¸ é›¨æ°´åˆ©ç”¨ç®¡ç†</div>
    <nav class="mt-3">
        <a href="/" class="nav-link">ğŸ“ é™é›¨é‡å°è´¦</a>
        <a href="/stats" class="nav-link">ğŸ“Š ç»Ÿè®¡ä¸­å¿ƒ</a>
        <a href="/import_page" class="nav-link active">ğŸ“¤ ä¸Šä¼ ä¸­å¿ƒ</a>
        <a href="/settings" class="nav-link">âš™ï¸ åå°è®¾ç½®</a>
        <a href="javascript:void(0)" onclick="confirmLogout()" class="nav-link text-warning"><i class="bi bi-box-arrow-right"></i> é€€å‡ºç™»å½•</a>
    </nav>
</div>

<div class="main-container">
    <div class="upload-card">
        <div class="text-center mb-4">
            <h3 class="fw-bold text-dark">æ‰¹é‡å¯¼å…¥æ•°æ®</h3>
            <p class="text-muted">æ”¯æŒ TXT æ ¼å¼ï¼Œå¿«é€ŸåŒæ­¥é™é›¨è®°å½•</p>
        </div>

        <div class="format-hint">
            <small class="text-warning-emphasis fw-bold d-block mb-1"><i class="bi bi-lightbulb"></i> æ ¼å¼å°è´´å£«</small>
            <code class="text-dark" style="font-size: 0.85rem;">å¹´ä»½, é™é›¨é‡, æº¢æµé‡, æ´—è½¦, çŒæº‰</code>
            <span class="d-block text-muted mt-1" style="font-size: 0.75rem;">ä¾‹å¦‚ï¼š2026, 180.5, 20.2, 45, 90</span>
        </div>

        <div class="upload-area" id="dropZone" onclick="document.getElementById('fileInput').click()">
            <input type="file" id="fileInput" accept=".txt" class="d-none">

            <div id="idleState">
                <i class="bi bi-cloud-arrow-up file-icon"></i>
                <h5 class="fw-bold">ç‚¹å‡»æˆ–æ‹–æ‹½æ–‡ä»¶åˆ°è¿™é‡Œ</h5>
                <p class="text-muted small">åªæ¥å— .txt æ–‡æœ¬æ–‡ä»¶</p>
            </div>

            <div id="selectedState" class="d-none">
                <i class="bi bi-file-earmark-check-fill text-primary file-icon"></i>
                <h5 id="fileName" class="text-primary fw-bold text-truncate px-4"></h5>
                <div class="mt-3">
                    <button class="btn btn-primary px-4 shadow-sm me-2" id="uploadBtn" onclick="event.stopPropagation(); startUpload();">ç¡®è®¤åŒæ­¥</button>
                    <button class="btn btn-outline-secondary px-4" onclick="event.stopPropagation(); resetUI();">é‡ç½®</button>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    const fileInput = document.getElementById('fileInput');
    const dropZone = document.getElementById('dropZone');
    const idleState = document.getElementById('idleState');
    const selectedState = document.getElementById('selectedState');
    const fileName = document.getElementById('fileName');

    ['dragenter', 'dragover'].forEach(n => dropZone.addEventListener(n, e => {
        e.preventDefault(); dropZone.classList.add('dragover');
    }));
    ['dragleave', 'drop'].forEach(n => dropZone.addEventListener(n, e => {
        e.preventDefault(); dropZone.classList.remove('dragover');
    }));

    dropZone.addEventListener('drop', e => {
        const file = e.dataTransfer.files[0];
        if (file) handleFile(file);
    });

    fileInput.onchange = () => { if (fileInput.files[0]) handleFile(fileInput.files[0]); };

    async function confirmLogout() {
    const result = await Swal.fire({
        title: 'ç¡®å®šè¦é€€å‡ºç³»ç»Ÿå—ï¼Ÿ',
        text: "é€€å‡ºåéœ€è¦é‡æ–°ç™»å½•æ‰èƒ½æŸ¥çœ‹æ•°æ®",
        icon: 'question',
        showCancelButton: true,
        confirmButtonColor: '#3182ce',
        cancelButtonColor: '#6c757d',
        confirmButtonText: 'ç¡®å®šé€€å‡º',
        cancelButtonText: 'å–æ¶ˆ',
        heightAuto: false,     // é˜²æ­¢é¡µé¢è·³åŠ¨
        scrollbarPadding: false // é˜²æ­¢èœå•ä½ç§»
    });

    if (result.isConfirmed) {
        window.location.href = '/logout_page';
    }
}

    function handleFile(file) {
        if (!file.name.endsWith('.txt')) {
            Swal.fire({
                title: 'æ–‡ä»¶é”™è¯¯',
                text: 'è¯·ä¸Šä¼  .txt æ ¼å¼çš„æ–‡æœ¬æ–‡ä»¶',
                icon: 'error',
                backdrop: true,
                heightAuto: false // é˜²æ­¢è·³åŠ¨
            });
            return;
        }
        fileName.innerText = file.name;
        idleState.classList.add('d-none');
        selectedState.classList.remove('d-none');
    }

    function resetUI() {
        fileInput.value = '';
        idleState.classList.remove('d-none');
        selectedState.classList.add('d-none');
    }

    async function startUpload() {
        const file = fileInput.files[0];
        const formData = new FormData();
        formData.append('file', file);

        Swal.fire({
            title: 'æ­£åœ¨å¤„ç†æ•°æ®',
            html: 'è¯·ç¨å€™ï¼Œæ­£åœ¨ä¸ºæ‚¨è§£æå¹¶å½•å…¥ç³»ç»Ÿ...',
            allowOutsideClick: false,
            heightAuto: false, // æå…¶é‡è¦ï¼šé˜²æ­¢ Swal æ”¹å˜ body é«˜åº¦
            didOpen: () => { Swal.showLoading(); }
        });

        try {
            const res = await fetch('/api/upload', { method: 'POST', body: formData });
            const result = await res.json();

            if (result.status === 'success') {
                Swal.fire({
                    icon: 'success',
                    title: 'åŒæ­¥æˆåŠŸ',
                    text: result.message,
                    timer: 2000,
                    showConfirmButton: false,
                    heightAuto: false
                }).then(() => {
                    window.location.href = '/';
                });
            } else {
                Swal.fire({
                    icon: 'error',
                    title: 'åŒæ­¥å¤±è´¥',
                    text: result.message,
                    heightAuto: false
                });
            }
        } catch (err) {
            Swal.fire({
                icon: 'warning',
                title: 'ç½‘ç»œé”™è¯¯',
                text: 'æ— æ³•è¿æ¥åˆ°æœåŠ¡å™¨',
                heightAuto: false
            });
        }
    }
</script>
</body>
</html>