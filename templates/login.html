<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç™»å½• - é›¨æ°´åˆ©ç”¨ç®¡ç†ç³»ç»Ÿ</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <style>
        :root {
            --primary-color: #4a7c59; /* æ£®æ—æ·±ç»¿ï¼Œç¨³é‡æŠ¤çœ¼ */
            --error-color: #e67e22;   /* æŸ”å’Œçš„æ©™è‰²æŠ¥é”™ï¼Œä¸åˆºçœ¼ */
            --bg-start: #2d3a30;      /* æ·±æ²‰çš„å¢¨ç»¿ */
            --bg-end: #8fbc8f;        /* è±†æ²™ç»¿ */
        }

        html, body { height: 100%; margin: 0; overflow: hidden; }

        body {
            display: flex; align-items: center; justify-content: center;
            /* æŠ¤çœ¼æ¸å˜ï¼šæ·±è‰²è°ƒèƒŒæ™¯èƒ½æ˜¾è‘—é™ä½å±å¹•äº®åº¦å¯¹çœ¼ç›çš„åˆºæ¿€ */
            background: linear-gradient(135deg, var(--bg-start), #4a5d4e, var(--bg-end));
            background-size: 300% 300%;
            animation: gradientMove 10s ease-in-out infinite;
            font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
        }

        @keyframes gradientMove {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        /* æ¯›ç»ç’ƒå¡ç‰‡ï¼šé™ä½é€æ˜åº¦ï¼Œå‡å°‘å…‰å½±æŠ˜å°„å¯¹è§†çº¿çš„å¹²æ‰° */
        .login-card {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.15);
            border-radius: 24px;
            padding: 50px 40px;
            width: 100%;
            max-width: 420px;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.3);
            color: #e8f5e9;
            text-align: center;
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-8px); }
            75% { transform: translateX(8px); }
        }
        .shake { animation: shake 0.3s ease-in-out; }

        .brand-icon {
            font-size: 3.5rem; margin-bottom: 10px; display: inline-block;
            filter: drop-shadow(0 0 10px rgba(143, 188, 143, 0.3));
        }
        h3 { font-weight: 600; letter-spacing: 2px; margin-bottom: 30px; color: #f0f4f0; }

        .form-label { color: rgba(240, 244, 240, 0.8); font-size: 0.85rem; font-weight: 500; margin-bottom: 8px; display: block; }

        .input-group {
            border-radius: 12px; overflow: hidden;
            background: rgba(0, 0, 0, 0.15);
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: all 0.3s;
        }
        .input-group.is-invalid { border-color: var(--error-color) !important; box-shadow: 0 0 10px rgba(230, 126, 34, 0.2); }

        .input-group-text {
            width: 50px; justify-content: center;
            background: rgba(255, 255, 255, 0.05) !important;
            border: none !important; color: #8fbc8f !important; font-size: 1.2rem;
        }

        .form-control {
            background: transparent !important; border: none !important;
            color: #ffffff !important; padding: 12px 15px; box-shadow: none !important;
        }
        .form-control::placeholder { color: rgba(255, 255, 255, 0.3); }

        #error-msg {
            color: var(--error-color); font-size: 0.85rem; margin-top: 15px; min-height: 20px;
            display: flex; align-items: center; justify-content: center;
            opacity: 0; transition: opacity 0.3s ease; font-weight: 500;
        }
        #error-msg.visible { opacity: 1; }

        .btn-login {
            background: #4a7c59; /* æ·±ç»¿è‰²æŒ‰é’®ï¼Œè€çœ‹ä¸”æœ‰ç‚¹å‡»æ¬²æœ› */
            color: white; border: none;
            padding: 14px; border-radius: 12px; font-weight: 600; width: 100%;
            margin-top: 10px; transition: all 0.3s ease; text-transform: uppercase;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }
        .btn-login:hover { background: #5a8c69; transform: translateY(-2px); box-shadow: 0 6px 20px rgba(0,0,0,0.3); }
        .btn-login:disabled { background: #3d5a45; opacity: 0.8; }
    </style>
</head>
<body>

<div class="login-card" id="loginCard">
    <div class="brand-icon">ğŸŒ±</div>
    <h3>é›¨æ°´åˆ©ç”¨ç®¡ç†</h3>

    <form id="loginForm">
        <div class="mb-4 text-start">
            <label class="form-label ms-1">ç³»ç»Ÿè´¦å·</label>
            <div class="input-group" id="userGroup">
                <span class="input-group-text"><i class="bi bi-person"></i></span>
                <input type="text" name="username" class="form-control" placeholder="è¯·è¾“å…¥ç”¨æˆ·å" required autocomplete="off">
            </div>
        </div>

        <div class="mb-2 text-start">
            <label class="form-label ms-1">å®‰å…¨å¯†ç </label>
            <div class="input-group" id="passGroup">
                <span class="input-group-text"><i class="bi bi-lock"></i></span>
                <input type="password" name="password" class="form-control" placeholder="è¯·è¾“å…¥å¯†ç " required>
            </div>
        </div>

        <div id="error-msg">
            <i class="bi bi-shield-exclamation me-2"></i>
            <span id="error-text">è´¦å·æˆ–å¯†ç è®¤è¯å¤±è´¥</span>
        </div>

        <button type="submit" class="btn-login" id="submitBtn">ç™»å½•ç³»ç»Ÿ</button>
    </form>

    <div class="footer-text mt-4 small" style="color: rgba(255,255,255,0.4)">
        Eco-friendly Management System<br>
        &copy; 2026 ä¸ºå¯æŒç»­ç¯å¢ƒåŠ©åŠ›
    </div>
</div>

<script>
    document.getElementById('loginForm').onsubmit = async (e) => {
    e.preventDefault();
    const btn = document.getElementById('submitBtn');
    const originalText = btn.innerText;

    btn.disabled = true;
    btn.innerHTML = '<span class="spinner-border spinner-border-sm me-2"></span>éªŒè¯ä¸­...';

    try {
        const formData = new FormData(e.target);
        const res = await fetch('/api/login', {
            method: 'POST',
            body: formData,
            credentials: 'same-origin' // é‡è¦ï¼šæºå¸¦ Cookie
        });

        // æ£€æŸ¥å“åº”çŠ¶æ€
        if (!res.ok) {
            throw new Error('ç½‘ç»œè¯·æ±‚å¤±è´¥');
        }

        const result = await res.json();

        if (result.status === 'success') {
            Swal.fire({
                icon: 'success',
                title: 'ç™»å½•æˆåŠŸ',
                text: 'æ¬¢è¿è¿›å…¥ç®¡ç†å°è´¦ç³»ç»Ÿ',
                showConfirmButton: false,
                timer: 1000,
                heightAuto: false
            }).then(() => {
                // å¼ºåˆ¶è·³è½¬åˆ°é¦–é¡µ
                window.location.replace('/');
            });
        } else {
            throw new Error(result.message || 'ç™»å½•å¤±è´¥');
        }
    } catch (err) {
        console.error('ç™»å½•é”™è¯¯:', err);
        Swal.fire({
            icon: 'error',
            title: 'ç™»å½•å¤±è´¥',
            text: err.message || 'è¯·æ£€æŸ¥ç½‘ç»œè¿æ¥åé‡è¯•',
            confirmButtonColor: '#23a6d5',
            heightAuto: false
        });
        btn.disabled = false;
        btn.innerText = originalText;
    }
    };
    // const loginForm = document.getElementById('loginForm');
    // const loginCard = document.getElementById('loginCard');
    // const errorMsg = document.getElementById('error-msg');
    // const userGroup = document.getElementById('userGroup');
    // const passGroup = document.getElementById('passGroup');
    // const submitBtn = document.getElementById('submitBtn');
    //
    // loginForm.onsubmit = async (e) => {
    //     e.preventDefault();
    //
    //     errorMsg.classList.remove('visible');
    //     userGroup.classList.remove('is-invalid');
    //     passGroup.classList.remove('is-invalid');
    //     submitBtn.disabled = true;
    //     submitBtn.innerHTML = '<span class="spinner-border spinner-border-sm me-2"></span>è®¤è¯ä¸­...';
    //
    //     try {
    //         const formData = new FormData(e.target);
    //         const res = await fetch('/api/login', {
    //             method: 'POST',
    //             body: formData,
    //             credentials: 'same-origin' // â­â­â­ æ ¸å¿ƒ
    //         });
    //         const result = await res.json();
    //
    //         if (result.status === 'success') {
    //             Swal.fire({
    //                 icon: 'success',
    //                 title: 'æ¬¢è¿å›æ¥',
    //                 text: 'ç³»ç»Ÿè®¤è¯æˆåŠŸï¼Œå‡†å¤‡è·³è½¬...',
    //                 showConfirmButton: false,
    //                 timer: 1000,
    //                 heightAuto: false,
    //                 background: '#f0f4f0'
    //             }).then(() => {
    //                 window.location.href = '/';
    //             });
    //         } else {
    //             throw new Error(result.message);
    //         }
    //     } catch (err) {
    //         submitBtn.disabled = false;
    //         submitBtn.innerText = "ç™»å½•ç³»ç»Ÿ";
    //
    //         errorMsg.classList.add('visible');
    //         userGroup.classList.add('is-invalid');
    //         passGroup.classList.add('is-invalid');
    //
    //         loginCard.classList.remove('shake');
    //         void loginCard.offsetWidth;
    //         loginCard.classList.add('shake');
    //     }
    // };
    //
    // document.querySelectorAll('input').forEach(input => {
    //     input.oninput = () => {
    //         errorMsg.classList.remove('visible');
    //         userGroup.classList.remove('is-invalid');
    //         passGroup.classList.remove('is-invalid');
    //     };
    // });
</script>
</body>
</html>